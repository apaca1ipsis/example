# Конфигурация "Две партиции - два обработчика"

Запустите контейнер с kafka

``` sh
docker-compose up -d
```

Создайте топик numbers с двумя партициями

``` sh
docker exec -it kafka kafka-topics --create --topic numbers --bootstrap-server localhost:9092 --partitions 2
```

Запустите модели баз данных (каждую в отдельном терминале)

``` sh
# A.db
PORT=10000 go run cmd/db/main.go
```

``` sh
# B.db
PORT=10001 go run cmd/db/main.go
```

``` sh
# C.db
PORT=10002 go run cmd/db/main.go
```

Запустите два экземпляра приложения `service` (каждый в отдельном терминале)

``` sh
go run cmd/service/main.go
```

``` sh
go run cmd/service/main.go
```

Запустите приложение `gen` в отдельном терминале

``` sh
go run cmd/gen/main.go
```

Приложение `gen` напишет в терминал о том, что сообщения отправлены в kafka

``` sh
YYYY/MM/DD 12:00:00 INFO messages sent
```

Последим обработается сообщение С:3. В терминале С.db видим последнюю запись журнала

``` sh
YYYY/MM/DD 12:00:06 INFO written number=C:3
```

Из 9 сообщений, сгенерированных приложением `gen`, 6 сообщений (с ключами A и C) находились в партиции kafka с номером 0. Остальные 3 сообщения (с ключем B) находились в партиции kafka с номером 1 и обрабатывались независимо. Итоговое время обработки всех сообщений определяется временем обработки сообщений из партиции 0, посокльку сообщений там было больше, чем в партиции 1.

``` txt
12:00:06 - 12:00:00 = 6 секунд
```